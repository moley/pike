buildscript {
    repositories {
	maven { url "http://repo1.maven.org/maven2" }
    }
}

subprojects {
   apply {
      plugin 'eclipse'
   }
}
allprojects {

    version=0.1

    group = 'org.pike'

    apply {
        plugin 'idea'
        plugin 'groovy'
        plugin 'jacoco'
    }

//Only workaround
    uploadArchives {
        repositories {
            ivy {
                credentials {
                    username "deployment"
                    password "deployment123"
                }
                url "http://nexus.intra.vsa.de:8081/nexus/content/repositories/gradleplugins"
            }
        }
    }

    repositories {
      mavenCentral()
      maven {
        url "http://mvnrepository.com/artifact/"
      }
    }


    dependencies {
        compile localGroovy()
        compile gradleApi()
    }

    gradle.taskGraph.whenReady { taskGraph ->
        tasks.withType(Test).each { Test test ->
            test.ignoreFailures = true
        }
    }

    // Tests in package integration are only called in task integrationtest
    test {
        exclude "**/integration/**"
    }

    task integrationtest(type: Test) {
        include "**/integration/**"
        jvmArgs "-XX:MaxPermSize=128m"
    }

}




//Because the test projects can't be subprohects (because you can test them isolated anymore) we must
//call the creation of the IDE files by hand

def subs = [];
project.subprojects.each {
    subs.add(':' + it.name + ':jar');
}

def testprojects = [];
for (File f : projectDir.listFiles()) {
    if (f.name.startsWith("testproject") && f.isDirectory()) {
        testprojects.add(f.name)
    }
}


jacocoTestReport {
    reports {
        xml.enabled false
        csv.enabled false
        html.destination "${buildDir}/jacocoHtml"
    }
}


