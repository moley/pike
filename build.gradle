buildscript {
    repositories {
	maven { url "http://repo1.maven.org/maven2" }
    }
}

subprojects {
   apply {
      plugin 'eclipse'
      plugin 'maven'
   }

  uploadArchives {
    repositories {
        mavenDeployer {
            repository(url:"https://api.bintray.com/maven/markusoley/pike/${project.name}") {
                String username = System.properties['bintray.username']
                String password = System.properties['bintray.password']
                authentication( userName: username, password: password)
            }
        }
    }
  }
}

allprojects {

    group = 'org.pike'

    apply {
        plugin 'idea'
        plugin 'groovy'
        plugin 'jacoco'
    }

    repositories {
      mavenCentral()
      maven {
        url "http://mvnrepository.com/artifact/"
      }
    }


    dependencies {
        compile localGroovy()
        compile gradleApi()
    }

    gradle.taskGraph.whenReady { taskGraph ->
        tasks.withType(Test).each { Test test ->
            test.ignoreFailures = true
        }
    }

    // Tests in package integration are only called in task integrationtest
    test {
        exclude "**/integration/**"
    }

    task integrationtest(type: Test) {
        include "**/integration/**"
        jvmArgs "-XX:MaxPermSize=128m"
    }

}




//Because the test projects can't be subprohects (because you can test them isolated anymore) we must
//call the creation of the IDE files by hand

def subs = [];
project.subprojects.each {
    subs.add(':' + it.name + ':jar');
}

def testprojects = [];
for (File f : projectDir.listFiles()) {
    if (f.name.startsWith("testproject") && f.isDirectory()) {
        testprojects.add(f.name)
    }
}


jacocoTestReport {
    reports {
        xml.enabled false
        csv.enabled false
        html.destination "${buildDir}/jacocoHtml"
    }
}


